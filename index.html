<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OperaciÃ³n Temazo ðŸŽ¶</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #724d95;
      --secondary: #5d69b6;
      --dark: #1a1a2e;
      --light: #f8f9fa;
      --accent: #9766f9;
      --gold: #ffd700;
      --silver: #c0c0c0;
      --bronze: #cd7f32;
      --lyrics-bg: rgba(147, 112, 219, 0.15);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #8a2be2, #5d69b6, #4169e1);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      color: var(--light);
      min-height: 100vh;
      padding: 20px;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      padding: 30px 0;
      margin-bottom: 30px;
    }
    
    h1 {
      font-size: 3.5rem;
      margin-bottom: 10px;
      text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5);
      color: #000; /* TITULO en negro */
      background: none;
      -webkit-background-clip: initial;
      -webkit-text-fill-color: initial;
    }
    
    header p {
      font-size: 1.2rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .phase-indicator {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      padding: 15px;
      margin: 20px auto;
      text-align: center;
      max-width: 600px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .golden-ticket {
      background: linear-gradient(135deg, #ffd700, #ffb700);
      color: #000;
      padding: 10px 15px;
      border-radius: 8px;
      margin: 10px 0;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .golden-selector {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    
    .golden-btn {
      background: rgba(255, 215, 0, 0.2);
      border: 2px solid var(--gold);
      border-radius: 20px;
      padding: 8px 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .golden-btn.active {
      background: var(--gold);
      color: #000;
      font-weight: bold;
    }
    
    .judges {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .judge {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      width: 120px;
    }
    
    .judge-avatar {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    .judge-name {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .songs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin: 30px 0;
    }
    
    .song-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      position: relative;
    }
    
    .golden-pass {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--gold);
      color: #000;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      z-index: 10;
    }
    
    .lyrics-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      background: var(--accent);
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      font-size: 0.8rem;
    }
    
    .song-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    
    .song-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .song-image {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      object-fit: cover;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    
    .song-title {
      font-size: 1.5rem;
      margin-bottom: 5px;
      color: #ffffff; /* forzar tÃ­tulo de cada canciÃ³n en blanco */
    }
    
    .song-info {
      color: #ffffff; /* info artista / sugerida en blanco */
      font-size: 0.9rem;
    }
    
    .player-controls {
      padding: 15px 20px;
      background: rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .play-btn {
      background: var(--primary);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .play-btn:hover {
      transform: scale(1.1);
      background: #7731d6;
    }
    
    .progress-container {
      flex: 1;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .progress {
      height: 100%;
      background: linear-gradient(to right, var(--accent), var(--primary));
      border-radius: 10px;
      width: 0%;
      transition: width 0.1s linear;
    }
    
    .time {
      font-size: 0.8rem;
      color: #ddd;
      min-width: 80px;
      text-align: right;
    }
    
    .volume-control {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .volume-slider {
      width: 70px;
      -webkit-appearance: none;
      height: 6px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
    }
    
    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--secondary);
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }
    
    .rating-section {
      padding: 20px;
    }
    
    .ratings {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    
    .rating {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }
    
    .rating-emoji {
      font-size: 1.8rem;
      margin-bottom: 8px;
    }
    
    .rating-slider {
      width: 80%;
      margin: 5px 0;
      -webkit-appearance: none;
      height: 8px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
    }
    
    .rating-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }
    
    .rating-value {
      font-weight: bold;
      font-size: 1.1rem;
      margin-top: 5px;
    }
    
    .song-average {
      text-align: center;
      margin-top: 15px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
    }
    
    .average-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent);
    }
    
    .lyrics-container {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease;
      background: var(--lyrics-bg);
    }
    
    .lyrics-content {
      padding: 20px;
      font-style: italic;
      line-height: 1.6;
      text-align: center;
      color: #ffffff; /* letra en blanco dentro de la tarjeta */
      white-space: pre-wrap;
    }
    
    .lyrics-container.show {
      max-height: 500px;
    }
    
    .finalists-section, .elimination-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      margin: 40px 0;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: none;
    }
    
    .finalists-title {
      text-align: center;
      margin-bottom: 20px;
      font-size: 2rem;
      color: var(--accent);
    }
    
    .finalists-grid, .elimination-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    
    .finalist-card, .battle-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px;
      display: flex;
      align-items: center;
    }
    
    .finalist-rank {
      font-size: 2rem;
      font-weight: bold;
      margin-right: 15px;
      color: var(--accent);
      min-width: 40px;
      text-align: center;
    }
    
    .finalist-info {
      flex: 1;
    }
    
    .finalist-name {
      font-weight: bold;
      margin-bottom: 5px;
      color: #ffffff; /* finalistas en blanco */
    }
    
    .finalist-score {
      color: var(--secondary);
    }
    
    .battle-card {
      flex-direction: column;
      text-align: center;
      gap: 10px;
    }
    
    .battle-vs {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 10px 0;
      color: var(--accent);
    }
    
    .match-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 20px;
      margin: 20px 0;
    }
    
    .song-option {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      flex: 1;
      min-width: 280px;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    
    .song-option:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      border-color: var(--accent);
    }
    
    .song-option h4 {
      margin-bottom: 10px;
      color: var(--accent);
      font-size: 1.4rem;
    }
    
    .song-option audio {
      width: 100%;
      margin: 15px 0;
      border-radius: 5px;
    }
    
    .round-info {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .round-title {
      font-size: 2rem;
      color: var(--accent);
      margin-bottom: 5px;
    }
    
    .round-subtitle {
      font-size: 1.2rem;
      opacity: 0.8;
    }
    
    .winner-section {
      text-align: center;
      padding: 40px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      margin: 30px 0;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(147, 112, 219, 0.4); }
      70% { box-shadow: 0 0 0 20px rgba(147, 112, 219, 0); }
      100% { box-shadow: 0 0 0 0 rgba(147, 112, 219, 0); }
    }
    
    .winner-crown {
      font-size: 4rem;
      margin-bottom: 20px;
      color: var(--gold);
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-20px); }
      60% { transform: translateY(-10px); }
    }
    
    .winner-title {
      font-size: 2.5rem;
      color: var(--gold);
      margin-bottom: 10px;
    }
    
    .winner-name {
      font-size: 3rem;
      font-weight: bold;
      margin-bottom: 15px;
      background: linear-gradient(to right, var(--gold), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .winner-details {
      font-size: 1.2rem;
      margin-bottom: 20px;
      opacity: 0.9;
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background-color: var(--accent);
      opacity: 0.7;
      border-radius: 0;
      z-index: 1000;
      animation: confetti-fall 5s linear forwards;
    }
    
    @keyframes confetti-fall {
      0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 30px 0;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: #7731d6;
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: var(--secondary);
      color: white;
    }
    
    .btn-secondary:hover {
      background: #4c5aa7;
      transform: translateY(-2px);
    }
    
    .btn-gold {
      background: var(--gold);
      color: #000;
    }
    
    .btn-gold:hover {
      background: #ffcc00;
      transform: translateY(-2px);
    }
    
    .vote-btn {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 30px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 15px;
    }
    
    .vote-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    footer {
      text-align: center;
      margin-top: 50px;
      padding: 20px;
      font-size: 1.1rem;
      opacity: 0.8;
    }
    
    /* Overrides para forzar textos azules a blanco */
.finalists-title,
.song-option h4,
.battle-vs,
.finalist-rank,
.average-value,
.finalist-score,
.round-title,
.round-subtitle,
.song-option h4,
.song-image, /* si el icono necesita contraste */
.song-title { color: #ffffff !important; }
/* si hay textos con var(--secondary) tambiÃ©n: */
.finalist-score, .some-other-selector { color: #ffffff !important; }
/* Ajusta o aÃ±ade selectores segÃºn veas elementos azules en la pÃ¡gina */
    
    @media (max-width: 768px) {
      h1 {
        font-size: 2.5rem;
      }
      
      .songs-grid {
        grid-template-columns: 1fr;
      }
      
      .ratings {
        flex-direction: column;
        gap: 15px;
      }
      
      .player-controls {
        flex-wrap: wrap;
      }
      
      .volume-control {
        order: 3;
        width: 100%;
        justify-content: center;
        margin-top: 10px;
      }
      
      .controls {
        flex-direction: column;
        align-items: center;
      }
      
      .match-container {
        flex-direction: column;
      }
      
      .winner-name {
        font-size: 2.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸŽ¤ OperaciÃ³n Temazo ðŸŽ¤</h1>
      <p>Las canciones elegidas por Rym, Juli y Vaguepa. Â¡Califica y elige las mejores que pasarÃ¡n a la final!</p>
    </header>
    
    <div class="phase-indicator">
      <h2>Fase de ClasificaciÃ³n</h2>
      <p>Califica cada canciÃ³n del 1 al 10. Las 3 con mejor promedio + 3 pases de oro pasarÃ¡n a la fase eliminatoria.</p>
      <div class="golden-ticket">
        <i class="fas fa-crown"></i>
        <span>Selecciona 3 canciones para darles pase de oro (pasan directamente a la final)</span>
      </div>
      
      <div class="golden-selector" id="goldenSelector">
        <!-- Los botones de selecciÃ³n de pases de oro se generarÃ¡n con JavaScript -->
      </div>
    </div>
    
    <div class="judges">
      <div class="judge">
        <div class="judge-avatar">ðŸ‘¾</div>
        <div class="judge-name">Rym</div>
        <div class="judge-role">Juez</div>
      </div>
      <div class="judge">
        <div class="judge-avatar">âœ¨</div>
        <div class="judge-name">Juli</div>
        <div class="judge-role">Jueza</div>
      </div>
      <div class="judge">
        <div class="judge-avatar">ðŸ¦‹</div>
        <div class="judge-name">Vaguepa</div>
        <div class="judge-role">Jueza</div>
      </div>
    </div>
    
    <div class="songs-grid" id="songsContainer">
      <!-- Las canciones se generarÃ¡n con JavaScript -->
    </div>
    
    <div class="controls">
      <button class="btn btn-primary" id="calculateBtn">
        <i class="fas fa-calculator"></i> Calificar Finalistas
      </button>
      <button class="btn btn-gold" id="eliminationBtn">
        <i class="fas fa-fist-raised"></i> Iniciar Fase Eliminatoria
      </button>
      <button class="btn btn-secondary" id="resetBtn">
        <i class="fas fa-redo"></i> Reiniciar VotaciÃ³n
      </button>
    </div>
    
    <div class="finalists-section" id="finalistsSection">
      <h2 class="finalists-title">Finalistas</h2>
      <div class="finalists-grid" id="finalistsContainer">
        <!-- Los finalistas se mostrarÃ¡n aquÃ­ -->
      </div>
    </div>
    
    <div class="elimination-section" id="eliminationSection">
      <h2 class="finalists-title">Fase Eliminatoria</h2>
      <div id="eliminationContent">
        <!-- El contenido de eliminaciÃ³n se generarÃ¡ dinÃ¡micamente -->
      </div>
    </div>
    
    <footer>
      <p>ðŸ’¿ Hecho con cariÃ±o en VS Code âœ¨</p>
    </footer>
  </div>

  <script>
    // Array con las canciones y la informaciÃ³n corregida
    const songs = [
      { title: "Gold's Gone", author: "Freya Skye", suggestedBy: "Vaguepa", golden: false, lyrics: "Letra no disponible" },
      { title: "La Travesia", author: "Juan Luis Guerra", suggestedBy: "Vaguepa", golden: false, lyrics: "Letra no disponible" },
      { title: "San Fernando", author: "Juliana VelÃ¡squez", suggestedBy: "Vaguepa", golden: false, lyrics: "Letra no disponible" },
      { title: "Take On Me", author: "a-ha", suggestedBy: "Vaguepa", golden: false, lyrics: "Letra no disponible" },
      { title: "Viva La Vida", author: "Coldplay", suggestedBy: "Vaguepa", golden: false, lyrics: "Letra no disponible" },
      { title: "DESEO PERDER", author: "Milo J", suggestedBy: "Rym", golden: false, lyrics: "Letra no disponible" },
      { title: "SANGRE PARA DERRAMAR", author: "Milo J", suggestedBy: "Rym", golden: false, lyrics: "Letra no disponible" },
      { title: "Tus Vueltas", author: "Milo J", suggestedBy: "Rym", golden: false, lyrics: "Letra no disponible" },
      { title: "Ayer y Hoy", author: "Julio Jaramillo", suggestedBy: "Rym", golden: false, lyrics: "Ayer y hoy...\nMis sentimientos son iguales\nAyer y hoy...\nTe he querido y te quiero mÃ¡s\n\nAyer te dije te amo\nY hoy te repito te amo\nAyer juraste quererme\nY hoy me repites lo mismo\n\nAyer y hoy...\nMis sentimientos son iguales\nAyer y hoy...\nTe he querido y te quiero mÃ¡s" },
      { title: "ParaÃ­so (daÃ±a)", author: "Milo J", suggestedBy: "Rym", golden: false, lyrics: "Letra no disponible" },
      { title: "CorazÃ³n", author: "Danny Ocean", suggestedBy: "Juli", golden: false, lyrics: "Letra no disponible" },
      { title: "traitor", author: "Olivia Rodrigo", suggestedBy: "Juli", golden: false, lyrics: "Letra no disponible" },
      { title: "drivers license", author: "Olivia Rodrigo", suggestedBy: "Juli", golden: false, lyrics: "Letra no disponible" },
      { title: "vampire", author: "Olivia Rodrigo", suggestedBy: "Juli", golden: false, lyrics: "Letra no disponible" },
      { title: "Nunca vas a comprender", author: "Rita PayÃ©s, Elisabeth Roma", suggestedBy: "Juli", golden: false, lyrics: "Letra no disponible" }
    ];

    // Jueces con sus emojis actualizados
    const judges = [
      { id: 'judge1', emoji: 'ðŸ‘¾', name: 'Rym' },
      { id: 'judge2', emoji: 'âœ¨', name: 'Juli' },
      { id: 'judge3', emoji: 'ðŸ¦‹', name: 'Vaguepa' }
    ];

    // Inicializar puntuaciones
    let ratings = {};
    let currentlyPlaying = null;
    let audioElements = {};

    // Variables para el sistema de eliminaciÃ³n
    let eliminationRound = [];
    let currentMatch = 0;
    let nextRound = [];

    // Inicializar ratings
    songs.forEach((song, index) => {
      ratings[index] = {
        judge1: 0,
        judge2: 0,
        judge3: 0,
        average: 0
      };
    });

    // Formatear tiempo (segundos a MM:SS)
    function formatTime(seconds) {
      if (isNaN(seconds)) return "0:00";
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    // Generar selector de pases de oro
    function renderGoldenSelector() {
      const container = document.getElementById('goldenSelector');
      container.innerHTML = '';
      
      songs.forEach((song, index) => {
        const button = document.createElement('div');
        button.className = 'golden-btn';
        button.dataset.index = index;
        button.textContent = song.title;
        
        if (song.golden) {
          button.classList.add('active');
        }
        
        button.addEventListener('click', function() {
          toggleGoldenPass(index);
        });
        
        container.appendChild(button);
      });
    }

    // Alternar pase de oro para una canciÃ³n
    function toggleGoldenPass(index) {
      // Contar cuÃ¡ntos pases de oro hay actualmente
      const goldenCount = songs.filter(song => song.golden).length;
      
      // Si ya hay 3 pases y este no es uno de ellos, no permitir mÃ¡s
      if (goldenCount >= 3 && !songs[index].golden) {
        alert("Solo puedes seleccionar 3 pases de oro. Deselecciona uno primero.");
        return;
      }
      
      // Alternar el estado del pase de oro
      songs[index].golden = !songs[index].golden;
      
      // Actualizar la UI
      renderGoldenSelector();
      renderSongs();
    }

    // Generar las tarjetas de canciones
    function renderSongs() {
      const container = document.getElementById('songsContainer');
      container.innerHTML = '';
      
      songs.forEach((song, index) => {
        // Crear el objeto de audio
        const audio = new Audio(song.title + ".mp3");
        audioElements[index] = audio;
        
        const card = document.createElement('div');
        card.className = 'song-card';
        
        // AÃ±adir badge de pase de oro si corresponde
        if (song.golden) {
          const goldenBadge = document.createElement('div');
          goldenBadge.className = 'golden-pass';
          goldenBadge.innerHTML = '<i class="fas fa-crown"></i> Pase de Oro';
          card.appendChild(goldenBadge);
        }
        
        // AÃ±adir botÃ³n de letras
        const lyricsBtn = document.createElement('button');
        lyricsBtn.className = 'lyrics-btn';
        lyricsBtn.innerHTML = '<i class="fas fa-font"></i>';
        lyricsBtn.onclick = function(e) {
          e.stopPropagation();
          toggleLyrics(index);
        };
        card.appendChild(lyricsBtn);
        
        card.innerHTML += `
          <div class="song-header">
            <div class="song-image">ðŸŽµ</div>
            <div>
              <h3 class="song-title">${song.title}</h3>
              <div class="song-info">Artista: ${song.author} | Sugerida por: ${song.suggestedBy}</div>
            </div>
          </div>
          <div class="player-controls">
            <button class="play-btn" data-song="${index}">
              <i class="fas fa-play"></i>
            </button>
            <div class="progress-container" data-song="${index}">
              <div class="progress" data-song="${index}"></div>
            </div>
            <div class="time" data-song="${index}">0:00 / 0:00</div>
            <div class="volume-control">
              <i class="fas fa-volume-up"></i>
              <input type="range" class="volume-slider" min="0" max="1" step="0.1" value="0.7" data-song="${index}">
            </div>
          </div>
          <div class="rating-section">
            <div class="ratings">
              ${judges.map(judge => `
                <div class="rating">
                  <div class="rating-emoji">${judge.emoji}</div>
                  <input type="range" class="rating-slider" min="1" max="10" value="0" 
                         data-song="${index}" data-judge="${judge.id}">
                  <div class="rating-value">0</div>
                </div>
              `).join('')}

            </div>
            <div class="song-average">
              Promedio: <span class="average-value" id="average-${index}">0.0</span>
            </div>
          </div>
          <div class="lyrics-container" id="lyrics-${index}">
            <div class="lyrics-content">
              ${song.lyrics}
            </div>
          </div>
        `;
        container.appendChild(card);
      });
      
      // Configurar event listeners
      setupEventListeners();
    }

    // Mostrar/ocultar letras
    function toggleLyrics(index) {
      const lyricsContainer = document.getElementById(`lyrics-${index}`);
      lyricsContainer.classList.toggle('show');
    }

    // Configurar event listeners
    function setupEventListeners() {
      // Configurar event listeners para los controles de audio
      document.querySelectorAll('.play-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const songId = this.dataset.song;
          togglePlay(songId);
        });
      });
      
      document.querySelectorAll('.progress-container').forEach(container => {
        container.addEventListener('click', function(e) {
          const songId = this.dataset.song;
          const audio = audioElements[songId];
          const progressWidth = this.clientWidth;
          const clickX = e.offsetX;
          
          // Solo si el audio estÃ¡ cargado
          if (audio.duration) {
            audio.currentTime = (clickX / progressWidth) * audio.duration;
          }
        });
      });
      
      document.querySelectorAll('.volume-slider').forEach(slider => {
        slider.addEventListener('input', function() {
          const songId = this.dataset.song;
          const audio = audioElements[songId];
          audio.volume = this.value;
        });
      });
      
      // AÃ±adir event listeners a los sliders de rating
      document.querySelectorAll('.rating-slider').forEach(slider => {
        slider.addEventListener('input', function() {
          const songId = this.dataset.song;
          const judgeId = this.dataset.judge;
          const value = parseInt(this.value);
          
          // Actualizar valor mostrado
          this.nextElementSibling.textContent = value;
          
          // Actualizar datos
          ratings[songId][judgeId] = value;
          
          // Calcular nuevo promedio
          calculateAverage(songId);
        });
      });
    }

    // Reproducir o pausar una canciÃ³n
    function togglePlay(songId) {
      const audio = audioElements[songId];
      const playBtn = document.querySelector(`.play-btn[data-song="${songId}"]`);
      const icon = playBtn.querySelector('i');
      
      // Si hay otra canciÃ³n reproduciÃ©ndose, pausarla
      if (currentlyPlaying && currentlyPlaying !== audio) {
        currentlyPlaying.pause();
        const currentSongId = Object.keys(audioElements).find(key => audioElements[key] === currentlyPlaying);
        const currentPlayBtn = document.querySelector(`.play-btn[data-song="${currentSongId}"]`);
        if (currentPlayBtn) {
          currentPlayBtn.querySelector('i').classList.remove('fa-pause');
          currentPlayBtn.querySelector('i').classList.add('fa-play');
        }
      }
      
      if (audio.paused) {
        audio.play().catch(error => {
          console.error("Error al reproducir audio:", error);
          alert(`Error al cargar el archivo de audio: ${songs[songId].title}.mp3. AsegÃºrate de que el archivo existe en la misma carpeta que el HTML.`);
        });
        icon.classList.remove('fa-play');
        icon.classList.add('fa-pause');
        currentlyPlaying = audio;
      } else {
        audio.pause();
        icon.classList.remove('fa-pause');
        icon.classList.add('fa-play');
        currentlyPlaying = null;
      }
    }

    // Actualizar barras de progreso
    function updateProgressBars() {
      songs.forEach((song, index) => {
        const audio = audioElements[index];
        const progress = document.querySelector(`.progress[data-song="${index}"]`);
        const timeDisplay = document.querySelector(`.time[data-song="${index}"]`);
        
        if (audio.duration && !isNaN(audio.duration)) {
          const progressPercent = (audio.currentTime / audio.duration) * 100;
          if (progress) progress.style.width = `${progressPercent}%`;
          if (timeDisplay) timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
        }
      });
    }

    // Calcular promedio para una canciÃ³n
    function calculateAverage(songId) {
      const judgeScores = [ratings[songId].judge1, ratings[songId].judge2, ratings[songId].judge3];
      const sum = judgeScores.reduce((acc, score) => acc + score, 0);
      ratings[songId].average = sum / 3;
      
      // Actualizar UI
      const averageElement = document.getElementById(`average-${songId}`);
      if (averageElement) {
        averageElement.textContent = ratings[songId].average.toFixed(1);
      }
    }

    // Obtener finalistas (3 con pase de oro + 3 mejores puntuadas)
    function getFinalists() {
      // Crear array de canciones con sus Ã­ndices y promedios
      const songsWithRatings = songs.map((song, index) => {
        return {
          title: song.title,
          author: song.author,
          suggestedBy: song.suggestedBy,
          index: index,
          average: ratings[index].average,
          golden: song.golden,
          file: song.title + ".mp3"
        };
      });
      
      // Separar canciones con pase de oro
      const goldenSongs = songsWithRatings.filter(song => song.golden);
      
      // Ordenar canciones por promedio (excluyendo las con pase de oro)
      const nonGoldenSongs = songsWithRatings.filter(song => !song.golden);
      const sortedSongs = [...nonGoldenSongs].sort((a, b) => {
        return b.average - a.average;
      });
      
      // Tomar las 3 mejores (para un total de 6 con los pases de oro)
      const bestRatedSongs = sortedSongs.slice(0, 3);
      
      // Combinar pases de oro con mejores calificadas
      return [...goldenSongs, ...bestRatedSongs];
    }

    // Calcular y mostrar finalistas
    function calculateFinalists() {
      // Verificar que hay exactamente 3 pases de oro
      const goldenSongs = songs.filter(song => song.golden);
      if (goldenSongs.length !== 3) {
        alert("Debes seleccionar exactamente 3 canciones con pase de oro.");
        return;
      }
      
      const finalists = getFinalists();
      
      // Mostrar finalistas
      const container = document.getElementById('finalistsContainer');
      container.innerHTML = '';
      
      finalists.forEach((song, index) => {
        const card = document.createElement('div');
        card.className = 'finalist-card';
        
        let badge = '';
        if (song.golden) {
          badge = '<span style="color: #ffd700; margin-left: 10px;"><i class="fas fa-crown"></i> Pase de Oro</span>';
        }
        
        card.innerHTML = `
          <div class="finalist-rank">${index + 1}</div>
          <div class="finalist-info">
            <div class="finalist-name">${song.title} ${badge}</div>
            <div class="finalist-score">Artista: ${song.author} | Sugerida por: ${song.suggestedBy} | Promedio: ${song.average.toFixed(1)}</div>
          </div>
        `;
        container.appendChild(card);
      });
      
      // Mostrar secciÃ³n de finalistas
      document.getElementById('finalistsSection').style.display = 'block';
    }

    // --- SISTEMA DE ELIMINACIÃ“N MEJORADO ---
    function startElimination() {
      const finalists = getFinalists();
      
      // Verificar que hay 6 finalistas
      if (finalists.length !== 6) {
        alert("Debe haber exactamente 6 finalistas para comenzar la fase eliminatoria.");
        return;
      }
      
      eliminationRound = finalists;
      currentMatch = 0;
      nextRound = [];
      
      // Mostrar secciÃ³n de eliminaciÃ³n
      document.getElementById('eliminationSection').style.display = 'block';
      
      showMatch();
    }

    // Crear efecto de confeti
    function createConfetti() {
      const colors = ['#8a2be2', '#5d69b6', '#9370db', '#ffd700', '#6bff8f', '#9d6bff'];
      
      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.width = (Math.random() * 10 + 5) + 'px';
        confetti.style.height = (Math.random() * 10 + 5) + 'px';
        confetti.style.animationDelay = Math.random() * 5 + 's';
        document.body.appendChild(confetti);
        
        // Eliminar el confeti despuÃ©s de la animaciÃ³n
        setTimeout(() => {
          confetti.remove();
        }, 5000);
      }
    }

    // Mostrar un enfrentamiento (2 canciones)
    function showMatch() {
      const eliminationContent = document.getElementById('eliminationContent');
      
      if (currentMatch >= eliminationRound.length) {
        // Terminar ronda y pasar a la siguiente
        if (nextRound.length === 1) {
          // Ya hay ganador final
          createConfetti();
          eliminationContent.innerHTML = `
            <div class="winner-section">
              <div class="winner-crown">ðŸ‘‘</div>
              <h2 class="winner-title">Â¡TENEMOS GANADORA!</h2>
              <h1 class="winner-name">${nextRound[0].title}</h1>
              <div class="winner-details">
                <p>Artista: ${nextRound[0].author}</p>
                <p>Sugerida por: ${nextRound[0].suggestedBy}</p>
              </div>
              <audio controls src="${nextRound[0].file}" autoplay></audio>
              <div style="margin-top: 30px;">
                <button class="btn btn-gold" onclick="resetVoting()">
                  <i class="fas fa-redo"></i> Volver a Empezar
                </button>
              </div>
            </div>
          `;
        } else {
          // Preparar siguiente ronda (semifinal â†’ final)
          eliminationRound = nextRound;
          currentMatch = 0;
          nextRound = [];
          showMatch();
        }
        return;
      }

      // Dos canciones a enfrentarse
      let song1 = eliminationRound[currentMatch];
      let song2 = eliminationRound[currentMatch + 1];
      
      // Calcular nÃºmero de ronda
      let roundName = "Cuartos de Final";
      let roundSubtitle = "Elige la mejor canciÃ³n de cada enfrentamiento";
      if (eliminationRound.length === 4) {
        roundName = "Semifinal";
        roundSubtitle = "Las ganadoras pasarÃ¡n a la Gran Final";
      }
      if (eliminationRound.length === 2) {
        roundName = "Gran Final";
        roundSubtitle = "Â¡Elige la canciÃ³n ganadora del torneo!";
      }

      eliminationContent.innerHTML = `
        <div class="round-info">
          <h3 class="round-title">${roundName}</h3>
          <p class="round-subtitle">${roundSubtitle}</p>
        </div>
        <div class="match-container">
          <div class="song-option">
            <h4>${song1.title}</h4>
            <p>Artista: ${song1.author}</p>
            <p>Sugerida por: ${song1.suggestedBy}</p>
            <audio controls src="${song1.file}"></audio>
            <button class="vote-btn" onclick="voteWinner(0)">
              <i class="fas fa-vote-yea"></i> Votar por esta canciÃ³n
            </button>
          </div>
          <div style="display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; color: var(--accent);">
            VS
          </div>
          <div class="song-option">
            <h4>${song2.title}</h4>
            <p>Artista: ${song2.author}</p>
            <p>Sugerida por: ${song2.suggestedBy}</p>
            <audio controls src="${song2.file}"></audio>
            <button class="vote-btn" onclick="voteWinner(1)">
              <i class="fas fa-vote-yea"></i> Votar por esta canciÃ³n
            </button>
          </div>
        </div>
        <div style="text-align: center; margin-top: 20px; opacity: 0.7;">
          <p>Enfrentamiento ${Math.floor(currentMatch / 2) + 1} de ${eliminationRound.length / 2}</p>
        </div>
      `;
    }

    // Votar por una canciÃ³n ganadora del match
    function voteWinner(choice) {
      let winner = eliminationRound[currentMatch + choice];
      nextRound.push(winner);
      currentMatch += 2; // pasar al siguiente enfrentamiento
      showMatch();
    }

    // Reiniciar votaciÃ³n
    function resetVoting() {
      // Reiniciar ratings
      songs.forEach((song, index) => {
        ratings[index] = {
          judge1: 0,
          judge2: 0,
          judge3: 0,
          average: 0
        };
        song.golden = false; // Quitar todos los pases de oro
      });
      
      // Reset UI
      document.querySelectorAll('.rating-slider').forEach(slider => {
        slider.value = 0;
        slider.nextElementSibling.textContent = '0';
      });
      
      document.querySelectorAll('.average-value').forEach(el => {
        el.textContent = '0.0';
      });
      
      // Ocultar secciones
      document.getElementById('finalistsSection').style.display = 'none';
      document.getElementById('eliminationSection').style.display = 'none';
      
      // Pausar cualquier audio que se estÃ© reproduciendo
      if (currentlyPlaying) {
        currentlyPlaying.pause();
        currentlyPlaying = null;
      }
      
      // Resetear botones de reproducciÃ³n
      document.querySelectorAll('.play-btn i').forEach(icon => {
        icon.classList.remove('fa-pause');
        icon.classList.add('fa-play');
      });
      
      // Volver a renderizar para mostrar nuevos pases de oro
      renderGoldenSelector();
      renderSongs();
      
      // Reiniciar variables de eliminaciÃ³n
      eliminationRound = [];
      currentMatch = 0;
      nextRound = [];
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
      // Renderizar selectores de pases de oro
      renderGoldenSelector();
      
      // Renderizar canciones
      renderSongs();
      
      // Actualizar barras de progreso
      setInterval(updateProgressBars, 500);
      
      // Configurar botones
      document.getElementById('calculateBtn').addEventListener('click', calculateFinalists);
      document.getElementById('eliminationBtn').addEventListener('click', startElimination);
      document.getElementById('resetBtn').addEventListener('click', resetVoting);
      
      // Ocultar secciones inicialmente
      document.getElementById('finalistsSection').style.display = 'none';
      document.getElementById('eliminationSection').style.display = 'none';
    });
  </script>
</body>
</html><!-- Agrega esto antes de </body> -->
<div id="lyricsModal" class="lyrics-modal">
  <div class="lyrics-modal-content">
    <span class="lyrics-modal-close">&times;</span>
    <div id="lyricsModalBody"></div>
  </div>
</div>

<style>
.lyrics-modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0; top: 0;
  width: 100vw; height: 100vh;
  background: rgba(30,30,50,0.85);
  align-items: center; justify-content: center;
}
.lyrics-modal-content {
  background: #fff;
  margin: auto;
  padding: 30px 20px;
  border-radius: 18px;
  max-width: 500px;
  max-height: 70vh;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}
.lyrics-modal-close {
  position: absolute;
  top: 15px; right: 25px;
  font-size: 2rem;
  color: #333;
  cursor: pointer;
  font-weight: bold;
  z-index: 10;
}
#lyricsModalBody {
  overflow-y: auto;
  max-height: 55vh;
  padding-right: 10px;
  font-style: italic;
  line-height: 1.6;
  text-align: center;
  white-space: pre-line;
  color: #222; /* Mantener texto oscuro dentro del modal (el modal tiene fondo blanco) */
}
</style>

<!-- Modal HTML and CSS remain, but duplicate JS and container are removed. -->